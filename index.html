<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#f0f9ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>15 Mins Bathing Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sat: env(safe-area-inset-top);
            --sab: env(safe-area-inset-bottom);
            --sar: env(safe-area-inset-right);
            --sal: env(safe-area-inset-left);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0f9ff;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            overscroll-behavior: none;
            overflow-x: hidden;
            padding-left: var(--sal);
            padding-right: var(--sar);
        }

        .mono { font-family: 'JetBrains Mono', monospace; }
        
        button:active {
            transform: scale(0.97);
            opacity: 0.9;
        }

        .droplet-shadow { filter: drop-shadow(0 10px 15px rgba(56, 189, 248, 0.3)); }
        .droplet-active { filter: drop-shadow(0 10px 15px rgba(251, 113, 133, 0.4)); }
        
        @keyframes ripple {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.4); opacity: 0; }
        }
        
        .ripple {
            position: absolute;
            border: 4px solid #38bdf8;
            border-radius: 50%;
            animation: ripple 2s infinite;
        }

        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .custom-scroll::-webkit-scrollbar { height: 4px; width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #bae6fd; border-radius: 10px; }
        
        .recharts-responsive-container {
            min-height: 150px;
        }

        html, body {
            height: 100%;
            position: fixed;
            width: 100%;
        }
        #root {
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Hide scrollbar but keep functionality for tabs */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "htm": "https://esm.sh/htm@3.1.1",
        "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import htm from 'htm';
        import * as Recharts from 'recharts';

        const html = htm.bind(React.createElement);
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell 
        } = Recharts.default || Recharts;

        const SHAME_THRESHOLD_MS = 900000; // 15 minutes

        const translations = {
            en: {
                title: "15 Mins Bathing Challenge",
                start: "Start Bathing",
                end: "End Bathing",
                shameSong: "The Shame Song",
                trends: "Bathing Trends",
                weekly: "Weekly",
                monthly: "Monthly",
                yearly: "Yearly",
                minutes: "min",
                seconds: "sec",
                bathTooLong: "Bathing too long! Playing your song...",
                startSinging: "Start Singing",
                stopRecording: "Stop",
                delete: "Delete",
                noStats: "No records yet.",
                shameSongDesc: "If you bathe > 15 mins, we play this!",
                langToggle: "ÁπÅÈ´î‰∏≠Êñá",
                avgTime: "Avg. Time",
                totalBaths: "Total Baths",
                overtimeCount: "15+ Min",
                recentHistory: "Recent History",
                waterSaved: "Congratulations! You saved {{amount}}L of water",
            },
            zh: {
                title: "15 ÂàÜÈêòÊ≤ñÊ∂ºÊåëÊà∞",
                start: "ÈñãÂßãÊ¥óÊæ°",
                end: "ÁµêÊùüÊ¥óÊæ°",
                shameSong: "ÊÇÖËÄ≥ÁöÑÊ≠åËÅ≤",
                trends: "Ê¥óÊæ°Ë∂®Âã¢",
                weekly: "Êú¨ÈÄ±",
                monthly: "Êú¨Êúà",
                yearly: "Êú¨Âπ¥Â∫¶",
                minutes: "ÂàÜ",
                seconds: "Áßí",
                bathTooLong: "Ê¥óÂ§™‰πÖ‰∫ÜÔºÅÊ≠£Âú®Êí≠Êîæ‰Ω†ÁöÑÊ≠åËÅ≤...",
                startSinging: "ÈåÑË£ΩÊ≠åËÅ≤",
                stopRecording: "ÂÅúÊ≠¢",
                delete: "Âà™Èô§",
                noStats: "Â∞öÁÑ°Á¥ÄÈåÑ„ÄÇ",
                shameSongDesc: "Â¶ÇÊûú‰Ω†Ê¥óÊæ°Ë∂ÖÈÅé 15 ÂàÜÈêòÔºåÊàëÂÄëÊúÉÊí≠ÊîæÈÄôÊÆµÈåÑÈü≥ÔºÅ",
                langToggle: "English",
                avgTime: "Âπ≥ÂùáÊôÇÈñì",
                totalBaths: "Á∏ΩÊ¨°Êï∏",
                overtimeCount: "Ë∂ÖÊôÇÊ¨°Êï∏",
                recentHistory: "ÊúÄËøëÁ¥ÄÈåÑ",
                waterSaved: "ÊÅ≠Âñú‰Ω†ÔºÅ‰Ω†ÁØÄÁúÅ‰∫Ü {{amount}} ÂÖ¨ÂçáÊ∞¥",
            }
        };

        const formatTimer = (ms) => {
            const m = Math.floor(ms / 60000);
            const s = Math.floor((ms % 60000) / 1000);
            const c = Math.floor((ms % 1000) / 10);
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}:${c.toString().padStart(2, '0')}`;
        };

        const DropletButton = ({ isBathing, onClick, label }) => html`
            <button onClick=${onClick} className="relative w-48 h-64 focus:outline-none transition-all duration-300 group">
                <div className="absolute inset-0 flex items-center justify-center">
                    <svg viewBox="0 0 100 120" className=${`w-full h-full transition-all duration-500 ${isBathing ? 'fill-rose-400 droplet-active' : 'fill-sky-400 droplet-shadow group-hover:fill-sky-500'}`}>
                        <path d="M50 0 C50 0 10 45 10 75 C10 97 28 115 50 115 C72 115 90 97 90 75 C90 45 50 0 50 0 Z" />
                    </svg>
                </div>
                <div className="absolute inset-0 flex flex-col items-center justify-center text-white font-bold p-4 text-center z-10">
                    <span className="text-xl drop-shadow-md uppercase tracking-wider leading-tight">${label}</span>
                </div>
                ${isBathing && html`<div className="ripple inset-0 m-auto w-32 h-32 border-rose-300 opacity-50"></div>`}
            </button>
        `;

        const Recorder = ({ t, onSave, existingAudio, onDelete }) => {
            const [isRecording, setIsRecording] = useState(false);
            const [recordingTime, setRecordingTime] = useState(0);
            const mediaRecorderRef = useRef(null);
            const chunksRef = useRef([]);
            const timerRef = useRef(0);
            const inputRef = useRef(null);

            const getBestMimeType = () => {
                const types = [
                    'audio/webm;codecs=opus',
                    'audio/webm',
                    'audio/mp4',
                    'audio/aac',
                    'audio/ogg;codecs=opus'
                ];
                for (const type of types) {
                    if (window.MediaRecorder && MediaRecorder.isTypeSupported(type)) return type;
                }
                return null;
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    if (typeof event.target.result === 'string') {
                        onSave(event.target.result);
                    }
                };
                reader.readAsDataURL(file);
            };

            const triggerFallback = () => {
                // Short alert to notify user of switching mechanism
                alert("Direct recording restricted. Switching to native recorder...");
                if (inputRef.current) inputRef.current.click();
            };

            const startRecording = async () => {
                // Ensure mediaDevices exists
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    triggerFallback();
                    return;
                }

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const mime = getBestMimeType();
                    const options = mime ? { mimeType: mime } : {};
                    
                    const mediaRecorder = new MediaRecorder(stream, options);
                    mediaRecorderRef.current = mediaRecorder;
                    chunksRef.current = [];

                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) chunksRef.current.push(e.data);
                    };

                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunksRef.current, { type: mime || 'audio/webm' });
                        const reader = new FileReader();
                        reader.readAsDataURL(blob);
                        reader.onloadend = () => {
                            if (typeof reader.result === 'string') onSave(reader.result);
                        };
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    setIsRecording(true);
                    setRecordingTime(0);
                    timerRef.current = window.setInterval(() => setRecordingTime(p => p + 1), 1000);
                } catch (err) {
                    console.warn("WebRTC recording failed, attempting fallback:", err);
                    triggerFallback();
                }
            };

            const stopRecording = () => {
                if (mediaRecorderRef.current?.state !== 'inactive') mediaRecorderRef.current?.stop();
                setIsRecording(false);
                clearInterval(timerRef.current);
            };

            return html`
                <div className="bg-white rounded-[2rem] p-6 shadow-sm border border-sky-100 mt-6">
                    <h3 className="text-sky-800 font-bold text-lg mb-2 flex items-center">
                        <span className="mr-2">üé§</span> ${t.shameSong}
                    </h3>
                    <p className="text-sky-600 text-sm mb-4 leading-relaxed">${t.shameSongDesc}</p>
                    
                    <input 
                        type="file" 
                        accept="audio/*" 
                        capture="microphone" 
                        ref=${inputRef} 
                        onChange=${handleFileChange} 
                        className="hidden" 
                    />

                    ${existingAudio && !isRecording && html`
                        <div className="mb-4 space-y-3 animate-fade-in">
                            <audio src=${existingAudio} controls className="w-full h-10" />
                            <button onClick=${onDelete} className="text-rose-500 text-xs font-bold hover:underline flex items-center p-2">üóëÔ∏è ${t.delete}</button>
                        </div>
                    `}
                    
                    <div className="flex flex-col items-center">
                        ${isRecording ? html`
                            <div className="text-center animate-fade-in">
                                <div className="text-2xl mono text-rose-500 mb-4 animate-pulse">
                                    ${Math.floor(recordingTime / 60)}:${(recordingTime % 60).toString().padStart(2, '0')}
                                </div>
                                <button onClick=${stopRecording} className="bg-rose-500 text-white px-10 py-3 rounded-2xl font-bold shadow-lg active:bg-rose-600 transition-colors uppercase tracking-widest text-xs">
                                    ${t.stopRecording}
                                </button>
                            </div>
                        ` : html`
                            <button onClick=${startRecording} className="bg-sky-50 text-sky-500 px-8 py-3 rounded-2xl font-bold shadow-sm border border-sky-100 flex items-center group active:bg-sky-500 active:text-white transition-colors">
                                <span className="mr-2">üî¥</span> ${t.startSinging}
                            </button>
                        `}
                    </div>
                </div>
            `;
        };

        const Statistics = ({ sessions, t, onDeleteSession }) => {
            const [activeTab, setActiveTab] = useState('weekly');

            const chartData = useMemo(() => {
                const now = new Date();
                const data = [];
                if (activeTab === 'weekly') {
                    for (let i = 6; i >= 0; i--) {
                        const d = new Date(); d.setDate(now.getDate() - i);
                        const label = d.toLocaleDateString(undefined, { weekday: 'short' });
                        const total = sessions.filter((s) => new Date(s.timestamp).toDateString() === d.toDateString())
                                              .reduce((acc, curr) => acc + curr.durationMs, 0);
                        data.push({ label, value: Math.round(total / 60000) });
                    }
                } else if (activeTab === 'monthly') {
                    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                    for (let i = 0; i < 4; i++) {
                        const start = new Date(startOfMonth); start.setDate(start.getDate() + (i * 7));
                        const end = new Date(start); end.setDate(end.getDate() + 7);
                        const total = sessions.filter((s) => s.timestamp >= start.getTime() && s.timestamp < end.getTime())
                                              .reduce((acc, curr) => acc + curr.durationMs, 0);
                        data.push({ label: `W${i+1}`, value: Math.round(total / 60000) });
                    }
                } else {
                    for (let i = 0; i < 12; i++) {
                        const d = new Date(now.getFullYear(), i, 1);
                        const label = d.toLocaleDateString(undefined, { month: 'short' });
                        const total = sessions.filter((s) => {
                            const sd = new Date(s.timestamp);
                            return sd.getFullYear() === now.getFullYear() && sd.getMonth() === i;
                        }).reduce((acc, curr) => acc + curr.durationMs, 0);
                        data.push({ label, value: Math.round(total / 60000) });
                    }
                }
                return data;
            }, [sessions, activeTab]);

            const stats = useMemo(() => {
                if (sessions.length === 0) return { avg: 0, total: 0, overtime: 0 };
                const totalMs = sessions.reduce((a, b) => a + b.durationMs, 0);
                return {
                    avg: Math.round((totalMs / sessions.length) / 60000),
                    total: sessions.length,
                    overtime: sessions.filter((s) => s.durationMs >= SHAME_THRESHOLD_MS).length
                };
            }, [sessions]);

            const alertThreshold = activeTab === 'weekly' ? 15 : (activeTab === 'monthly' ? 150 : 1800);

            return html`
                <div className="space-y-6">
                    <div className="bg-white rounded-[2rem] p-6 shadow-sm border border-sky-100">
                        <div className="flex flex-col mb-6">
                            <h3 className="text-sky-800 font-bold text-lg mb-3">üìä ${t.trends}</h3>
                            <div className="flex bg-sky-50 rounded-xl p-1 overflow-x-auto scrollbar-hide whitespace-nowrap">
                                ${(['weekly', 'monthly', 'yearly']).map(tab => html`
                                    <button 
                                        key=${tab} 
                                        onClick=${() => setActiveTab(tab)} 
                                        className=${`px-4 py-1.5 text-[12px] font-bold rounded-lg transition flex-shrink-0 ${activeTab === tab ? 'bg-sky-500 text-white shadow-md' : 'text-sky-400'}`}
                                        style=${{ minWidth: '80px' }}
                                    >
                                        ${t[tab]}
                                    </button>
                                `)}
                            </div>
                        </div>
                        ${sessions.length === 0 ? html`<div className="h-40 flex items-center justify-center text-sky-200 italic font-medium">${t.noStats}</div>` : html`
                            <div className="w-full">
                                <div className="h-44 w-full">
                                    <${ResponsiveContainer} width="100%" height="100%">
                                        <${BarChart} data=${chartData}>
                                            <${CartesianGrid} strokeDasharray="3 3" vertical=${false} stroke="#f0f9ff" />
                                            <${XAxis} dataKey="label" axisLine=${false} tickLine=${false} tick=${{ fontSize: 10, fill: '#bae6fd', fontWeight: 'bold' }} />
                                            <${YAxis} hide />
                                            <${Tooltip} cursor=${{ fill: '#f0f9ff' }} contentStyle=${{ borderRadius: '16px', border: 'none' }} />
                                            <${Bar} dataKey="value" radius=${[6, 6, 0, 0]}>
                                                ${chartData.map((e, idx) => html`<${Cell} key=${idx} fill=${e.value >= alertThreshold ? '#fb7185' : '#38bdf8'} />`)}
                                            <//>
                                        <//>
                                    <//>
                                </div>
                                <div className="grid grid-cols-3 gap-2 pt-6 border-t border-sky-50 mt-4">
                                    <div className="text-center">
                                        <p className="text-sky-400 text-[10px] uppercase font-black">${t.avgTime}</p>
                                        <p className="text-sky-900 text-xl font-black">${stats.avg}<span className="text-xs ml-1">${t.minutes}</span></p>
                                    </div>
                                    <div className="text-center border-x border-sky-50">
                                        <p className="text-sky-400 text-[10px] uppercase font-black">${t.totalBaths}</p>
                                        <p className="text-sky-900 text-xl font-black">${stats.total}</p>
                                    </div>
                                    <div className="text-center">
                                        <p className="text-rose-400 text-[10px] uppercase font-black">${t.overtimeCount}</p>
                                        <p className="text-rose-600 text-xl font-black">${stats.overtime}</p>
                                    </div>
                                </div>
                            </div>
                        `}
                    </div>

                    ${sessions.length > 0 && html`
                        <div className="bg-white rounded-[2rem] p-6 shadow-sm border border-sky-100">
                            <h3 className="text-sky-800 font-bold text-lg mb-4">üìú ${t.recentHistory}</h3>
                            <div className="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scroll">
                                ${sessions.slice(0, 10).map((s) => html`
                                    <div key=${s.id} className="flex items-center justify-between p-3 bg-sky-50/50 rounded-2xl group">
                                        <div className="flex flex-col">
                                            <span className="text-sky-900 font-bold text-xs">
                                                ${new Date(s.timestamp).toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}
                                            </span>
                                            <span className=${`text-xs font-black mono mt-1 ${s.durationMs >= SHAME_THRESHOLD_MS ? 'text-rose-500' : 'text-sky-400'}`}>
                                                ${formatTimer(s.durationMs)}
                                            </span>
                                        </div>
                                        <button 
                                            onClick=${() => onDeleteSession(s.id)}
                                            className="p-3 text-rose-300 active:text-rose-500 transition-colors"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                `)}
                            </div>
                        </div>
                    `}
                </div>
            `;
        };

        function App() {
            const [lang, setLang] = useState('en');
            const [isBathing, setIsBathing] = useState(false);
            const [elapsedMs, setElapsedMs] = useState(0);
            const [sessions, setSessions] = useState([]);
            const [shameSong, setShameSong] = useState(null);
            const [isShaming, setIsShaming] = useState(false);
            const [lastSavedLiters, setLastSavedLiters] = useState(null);
            
            const audioRef = useRef(null);
            const timerRef = useRef(0);
            const startTimeRef = useRef(0);

            const t = translations[lang];

            useEffect(() => {
                const s = localStorage.getItem('bath_sessions'); if (s) setSessions(JSON.parse(s));
                setShameSong(localStorage.getItem('shame_song'));
                const l = localStorage.getItem('app_lang'); if (l === 'en' || l === 'zh') setLang(l);
            }, []);

            const unlockAudio = () => {
                if (!audioRef.current) return;
                audioRef.current.play().then(() => {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                }).catch(() => {});
            };

            const startBathing = () => {
                unlockAudio();
                setIsBathing(true);
                setElapsedMs(0);
                setIsShaming(false);
                setLastSavedLiters(null);
                startTimeRef.current = Date.now();
                
                timerRef.current = window.setInterval(() => {
                    const delta = Date.now() - startTimeRef.current;
                    setElapsedMs(delta);
                    if (delta >= SHAME_THRESHOLD_MS && !isShaming && shameSong) {
                        setIsShaming(true);
                        if (audioRef.current) { 
                          audioRef.current.loop = true; 
                          audioRef.current.play().catch(console.error); 
                        }
                    }
                }, 10);
            };

            const endBathing = () => {
                clearInterval(timerRef.current);
                const finalElapsedMs = Math.ceil(elapsedMs / 10) * 10;
                
                if (finalElapsedMs > 0) {
                    const newSession = { 
                      id: Date.now().toString(), 
                      timestamp: Date.now(), 
                      durationMs: finalElapsedMs 
                    };
                    const updated = [newSession, ...sessions];
                    setSessions(updated);
                    localStorage.setItem('bath_sessions', JSON.stringify(updated));
                    
                    if (finalElapsedMs < SHAME_THRESHOLD_MS) {
                        const saved = Math.round(((SHAME_THRESHOLD_MS - finalElapsedMs) / 60000) * 10);
                        setLastSavedLiters(saved);
                    } else {
                        setLastSavedLiters(0);
                    }
                }
                
                setIsBathing(false);
                setIsShaming(false);
                if (audioRef.current) { audioRef.current.pause(); audioRef.current.currentTime = 0; }
            };

            const resetTimer = () => {
                if (isBathing) return;
                setElapsedMs(0);
                setIsShaming(false);
                if (audioRef.current) { audioRef.current.pause(); audioRef.current.currentTime = 0; }
            };

            return html`
                <div className="min-h-screen pb-[calc(2rem+env(safe-area-inset-bottom))] pt-[env(safe-area-inset-top)] flex flex-col">
                    <header className="px-6 pt-10 pb-8 flex justify-between items-center bg-white rounded-b-[3.5rem] shadow-sm border-b border-sky-50 sticky top-0 z-50">
                        <h1 className="text-xl font-black text-sky-900 flex items-center tracking-tight flex-shrink">
                            <span className="mr-3 text-2xl">üõÅ</span> ${t.title}
                        </h1>
                        <button onClick=${() => { const nl = lang === 'en' ? 'zh' : 'en'; setLang(nl); localStorage.setItem('app_lang', nl); }} className="bg-sky-50 text-sky-600 px-5 py-2 rounded-2xl font-black text-xs border border-sky-100 whitespace-nowrap flex-shrink-0 ml-2 active:bg-sky-100 transition-colors">
                            ${t.langToggle}
                        </button>
                    </header>
                    <main className="px-6 mt-10 max-w-lg mx-auto space-y-10 w-full flex-grow">
                        <div className="flex flex-col items-center">
                            <button 
                                onClick=${resetTimer} 
                                className=${`mono mb-6 transition-all ${isBathing ? 'opacity-90 scale-100' : 'active:scale-90'} ${isShaming ? 'text-rose-500 animate-bounce' : 'text-sky-900'}`}
                            >
                                <span className="text-[13vw] font-black tracking-tighter leading-none">${formatTimer(elapsedMs)}</span>
                            </button>
                            <div className="h-20 flex items-center justify-center text-center mb-6">
                                ${!isBathing && lastSavedLiters !== null && lastSavedLiters > 0 && html`
                                    <div onClick=${() => setLastSavedLiters(null)} className="bg-white/80 backdrop-blur-sm border-2 border-sky-100 p-4 rounded-3xl shadow-xl animate-fade-in flex flex-col items-center cursor-pointer">
                                        <p className="text-sky-600 font-black text-sm">‚ú® ${t.waterSaved.replace('{{amount}}', lastSavedLiters.toString())}</p>
                                    </div>
                                `}
                            </div>
                            <${DropletButton} isBathing=${isBathing} onClick=${isBathing ? endBathing : startBathing} label=${isBathing ? t.end : t.start} />
                            ${isShaming && html`<div className="mt-8 px-6 py-3 bg-rose-50 text-rose-500 border border-rose-100 rounded-3xl font-black animate-pulse text-sm">‚ö†Ô∏è ${t.bathTooLong}</div>`}
                        </div>
                        <${Statistics} sessions=${sessions} t=${t} onDeleteSession=${(id) => { const u = sessions.filter(x => x.id !== id); setSessions(u); localStorage.setItem('bath_sessions', JSON.stringify(u)); }} />
                        <${Recorder} t=${t} onSave=${(d) => { setShameSong(d); localStorage.setItem('shame_song', d); }} existingAudio=${shameSong} onDelete=${() => { setShameSong(null); localStorage.removeItem('shame_song'); }} />
                    </main>
                    ${shameSong && html`<audio ref=${audioRef} src=${shameSong} preload="auto" />`}
                    <footer className="mt-20 text-center text-sky-200 text-[10px] pb-12 font-black uppercase tracking-[0.2em]">¬© ${new Date().getFullYear()} ${t.title}</footer>
                </div>
            `;
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
